var zpp_nape;(function(a){var b;(function(e){var d=nape.geom.Vec2;var c=(function(){function f(){}f.indicator=function(l,m,k,h,j){var i=d.get(Math.cos(k),Math.sin(k));l.drawFilledCircle(m.add(i.mul(h,true),true),2,j);i.dispose()};f.drawSpiralSpring=function(T,Y,N,M,r,q,k,Q){if(Q===void 0){Q=4}if(N>M){var K=N;N=M;M=K;var F=r;r=q;q=F}if(N==M){return}var h=q-r;var v=M-N;var J=2*Math.PI*h/v;var B=((J<0)?-J:J);var u=Math.ceil(v/a.constraint.ZPP_AngleDraw.maxarc*3);var H=4*Q;var z=((u>H)?u:H);var O=v/z;var w=1/z;var l=Math.cos(N);var aa=Math.sin(N);var L=r+h*0;var I=L+0.75*B*Math.sin(2*Q*Math.PI*0);var X=d.get(Y.x+I*l,Y.y+I*aa);var W=h+1.5*Q*B*Math.PI*Math.cos(2*Q*Math.PI*0);var D=W*l-I*v*aa;var C=W*aa+I*v*l;var V=d.get(0,0,false);var A=d.get(0,0,false);var R=0;while(R<z){var S=R++;var o=N+O;var j=Math.cos(o);var Z=Math.sin(o);var U=r+h*(S+1)*w;var G=U+0.75*B*Math.sin(2*Q*Math.PI*(S+1)*w);V.setxy(Y.x+G*j,Y.y+G*Z);var P=h+1.5*Q*B*Math.PI*Math.cos(2*Q*Math.PI*(S+1)*w);var n=P*j-G*v*Z;var m=P*Z+G*v*j;var s=D*m-C*n;if(s*s<nape.Config.epsilon||D*n+C*m<=0||D*n+C*m>0.999){T.drawLine(X,V,k)}else{var E=((V.x-X.x)*m+(X.y-V.y)*n)/s;if(E<=0){T.drawLine(X,V,k)}else{A.x=X.x+D*E;A.y=X.y+C*E;T.drawCurve(X,A,V,k)}}N=o;l=j;aa=Z;D=n;C=m;X.set(V)}X.dispose();V.dispose();A.dispose()};f.drawSpiral=function(F,I,L,K,E,D,n){if(L>K){var u=L;L=K;K=u;var s=E;E=D;D=s}if(L==K){return}var y=D-E;var J=K-L;var z=Math.ceil(J/a.constraint.ZPP_AngleDraw.maxarc);var H=y/z;var G=J/z;var B=Math.cos(L);var k=Math.sin(L);var j=d.get(I.x+E*B,I.y+E*k);var o=y*B-E*J*k;var m=y*k+E*J*B;var h=d.get(0,0,false);var l=d.get(0,0,false);var v=0;while(v<z){++v;var C=E+H;var p=L+G;var A=Math.cos(p);var i=Math.sin(p);h.setxy(I.x+C*A,I.y+C*i);var x=y*A-C*J*i;var w=y*i+C*J*A;var q=o*w-m*x;if(q*q<nape.Config.epsilon){F.drawLine(j,h,n)}else{var r=((h.x-j.x)*w+(j.y-h.y)*x)/q;if(r<=0){F.drawLine(j,h,n)}else{l.x=j.x+o*r;l.y=j.y+m*r;F.drawCurve(j,l,h,n)}}E=C;L=p;B=A;k=i;o=x;m=w;j.set(h)}j.dispose();h.dispose();l.dispose()};f.maxarc=Math.PI/4;return f}());e.ZPP_AngleDraw=c})(b=a.constraint||(a.constraint={}))})(zpp_nape||(zpp_nape={}));var nape_DebugDraw;(function(g){var i=zpp_nape.constraint.ZPP_AngleJoint;var b=zpp_nape.constraint.ZPP_PivotJoint;var e=zpp_nape.constraint.ZPP_AngleDraw;var a=zpp_nape.constraint.ZPP_DistanceJoint;var d=zpp_nape.constraint.ZPP_LineJoint;var h=zpp_nape.constraint.ZPP_PulleyJoint;var c=zpp_nape.constraint.ZPP_UserConstraint;var f=zpp_nape.constraint.ZPP_WeldJoint;i.prototype.draw=function(E){var G=this.outer_zn;var u=5/Math.PI/2;if(G.body1!=G.body1.space.world){var z=G.ratio*G.body2.rotation-this.jointMin;var C=G.ratio*G.body2.rotation-this.jointMax;if(z>C){var s=z;z=C;C=s}if(G.body1.rotation>z){var q=G.body1.rotation;var p=C;var v=((q<p)?q:p);e.drawSpiral(E,G.body1.position,z,v,10+(z-z)*u,10+(v-z)*u,16776960)}else{if(!this.stiff&&G.body1.rotation<z){e.drawSpiralSpring(E,G.body1.position,G.body1.rotation,z,10+(G.body1.rotation-z)*u,10+(z-z)*u,16776960)}}if(G.body1.rotation<C){var F=G.body1.rotation;var o=z;var l=((F>o)?F:o);e.drawSpiral(E,G.body1.position,l,C,10+(l-z)*u,10+(C-z)*u,65535)}else{if(!this.stiff&&G.body1.rotation>C){e.drawSpiralSpring(E,G.body1.position,G.body1.rotation,C,10+(G.body1.rotation-z)*u,10+(C-z)*u,65535)}}e.indicator(E,G.body1.position,G.body1.rotation,10+(G.body1.rotation-z)*u,255)}if(G.body2!=G.body2.space.world){var A=(this.jointMin+G.body1.rotation)/G.ratio;var w=(this.jointMax+G.body1.rotation)/G.ratio;if(A>w){var r=A;A=w;w=r}if(G.body2.rotation>A){var D=G.body2.rotation;var n=w;var k=((D<n)?D:n);e.drawSpiral(E,G.body2.position,A,k,10+(A-A)*u,10+(k-A)*u,16776960)}else{if(!this.stiff&&G.body2.rotation<A){e.drawSpiralSpring(E,G.body2.position,G.body2.rotation,A,10+(G.body2.rotation-A)*u,10+(A-A)*u,16776960)}}if(G.body2.rotation<w){var B=G.body2.rotation;var m=A;var j=((B>m)?B:m);e.drawSpiral(E,G.body2.position,j,w,10+(j-A)*u,10+(w-A)*u,65535)}else{if(!this.stiff&&G.body2.rotation>w){e.drawSpiralSpring(E,G.body2.position,G.body2.rotation,w,10+(G.body2.rotation-A)*u,10+(w-A)*u,65535)}}e.indicator(E,G.body2.position,G.body2.rotation,10+(G.body2.rotation-A)*u,16711680)}};b.prototype.draw=function(q){var p=this.outer_zn;var m=p.anchor1;var l=p.body1.localPointToWorld(m);var o=p.anchor2;var j=p.body2.localPointToWorld(o);if(!this.stiff){var r=j.sub(l);var k=r.length;if(k!=0){q.drawSpring(l,j,16711935)}r.dispose()}q.drawFilledCircle(l,2,255);q.drawFilledCircle(j,2,16711680);l.dispose();j.dispose()};a.prototype.draw=function(q){var r=this.outer_zn;var p=r.anchor1;var l=r.body1.localPointToWorld(p);var o=r.anchor2;var k=r.body2.localPointToWorld(o);var m=k.sub(l);var j=m.length;if(j!=0){m.muleq(1/j);var u=l.add(k).muleq(0.5);var w=u.sub(m.mul(this.jointMin*0.5,true));var v=u.add(m.mul(this.jointMin*0.5,true));var t=u.sub(m.mul(this.jointMax*0.5,true));var s=u.add(m.mul(this.jointMax*0.5,true));q.drawLine(w,v,16776960);q.drawLine(t,w,65535);q.drawLine(s,v,65535);if(!this.stiff){if(j>this.jointMax){q.drawSpring(t,l,65535);q.drawSpring(s,k,65535)}else{if(j<this.jointMin){q.drawSpring(w,l,16776960);q.drawSpring(v,k,16776960)}}}u.dispose();w.dispose();v.dispose();t.dispose();s.dispose()}q.drawFilledCircle(l,2,255);q.drawFilledCircle(k,2,16711680);l.dispose();k.dispose();m.dispose()};d.prototype.draw=function(r){var u=this.outer_zn;var q=u.anchor1;var k=u.body1.localPointToWorld(q);var o=u.anchor2;var j=u.body2.localPointToWorld(o);var n=u.direction;var m=u.body1.localVectorToWorld(n);m.muleq(1/m.length);var p=u.jointMin;var x=u.jointMax;if(p<=zpp_nape.ZPP_Const.NEGINF()){p=-1000}if(x>=zpp_nape.ZPP_Const.POSINF()){x=1000}var A=j.sub(k);var l=A.dot(m);A.dispose();var w=k.add(m.mul(p,true));var t=k.add(m.mul(x,true));if(l>p){var v=x;r.drawLine(w,k.add(m.mul(((l<v)?l:v),true),true),16776960)}if(l<x){var z=p;r.drawLine(k.add(m.mul(((l>z)?l:z),true),true),t,65535)}if(!this.stiff){var s=((l<this.jointMin)?w.copy():((l>this.jointMax)?t.copy():k.add(m.mul(l,true))));r.drawSpring(s,j,16711935);s.dispose()}r.drawFilledCircle(k,2,255);r.drawFilledCircle(j,2,16711680);k.dispose();j.dispose();w.dispose();t.dispose()};h.prototype.draw=function(q){var t=this.outer_zn;var p=t.anchor1;var l=t.body1.localPointToWorld(p);var o=t.anchor2;var k=t.body2.localPointToWorld(o);var n=t.anchor3;var j=t.body3.localPointToWorld(n);var m=t.anchor4;var w=t.body4.localPointToWorld(m);var s=k.sub(l);var v=w.sub(j);var r=s.length;var u=v.length;this.drawLink(q,l,k,s,r,u*this.ratio,1,16776960,65535);this.drawLink(q,j,w,v,u,r,1/this.ratio,65535,16711935);q.drawFilledCircle(l,2,255);q.drawFilledCircle(k,2,16711680);q.drawFilledCircle(j,2,65280);q.drawFilledCircle(w,2,16711935);l.dispose();k.dispose();j.dispose();w.dispose();s.dispose();v.dispose()};h.prototype.drawLink=function(r,l,k,m,j,s,p,q,o){if(j!=0){m.muleq(1/j);var w=l.add(k).muleq(0.5);var t=(this.jointMin-s)*p;if(t<0){t=0}var x=(this.jointMax-s)*p;if(x<0){x=0}var z=w.sub(m.mul(t*0.5,true));var y=w.add(m.mul(t*0.5,true));var v=w.sub(m.mul(x*0.5,true));var u=w.add(m.mul(x*0.5,true));r.drawLine(z,y,q);r.drawLine(v,z,o);r.drawLine(u,y,o);if(!this.stiff){if(j>x){r.drawSpring(v,l,o);r.drawSpring(u,k,o)}else{if(j<t){r.drawSpring(z,l,q);r.drawSpring(y,k,q)}}}w.dispose();z.dispose();y.dispose();v.dispose();u.dispose()}};c.prototype.draw=function(j){this.outer_zn.__draw(j)};f.prototype.draw=function(u){var v=this.outer_zn;var r=v.anchor1;var l=v.body1.localPointToWorld(r);var o=v.anchor2;var k=v.body2.localPointToWorld(o);if(!this.stiff){var m=k.sub(l);var j=m.length;if(j!=0){u.drawSpring(l,k,16711935)}m.dispose();var q=5/Math.PI/2;if(v.body1!=v.body1.space.world){var w=v.body2.rotation-v.phase;var p=v.body1.rotation;if(p>w){var y=p;p=w;w=y}e.drawSpiralSpring(u,v.body1.position,p,w,10+(p-p)*q,10+(w-p)*q,16711808);e.indicator(u,v.body1.position,v.body1.rotation,10+(v.body1.rotation-p)*q,16711808)}if(v.body2!=v.body2.space.world){var x=v.phase+v.body1.rotation;var z=v.body2.rotation;if(z>x){var s=z;z=x;x=s}e.drawSpiralSpring(u,v.body2.position,z,x,10+(z-z)*q,10+(x-z)*q,8388863);e.indicator(u,v.body2.position,v.body2.rotation,10+(v.body2.rotation-z)*q,8388863)}}u.drawFilledCircle(l,2,255);u.drawFilledCircle(k,2,16711680);l.dispose();k.dispose()}})(nape_DebugDraw||(nape_DebugDraw={}));